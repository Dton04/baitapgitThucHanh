<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quản lý Sản phẩm - CRUD</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #f0f0f0;
      }
      .actions button {
        margin-right: 5px;
      }
      .filter {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h2>Quản lý Sản phẩm (CRUD)</h2>
    <form id="productForm">
      <input type="hidden" id="editIndex" />
      <label>Tên sản phẩm: <input type="text" id="name" required /></label>
      <label>Loại: <input type="text" id="category" required /></label>
      <label>Giá: <input type="number" id="price" required /></label>
      <button type="submit">Thêm / Cập nhật</button>
    </form>

    <div class="filter">
      <label
        >Tìm kiếm:
        <input type="text" id="search" placeholder="Nhập tên sản phẩm..."
      /></label>
      <label
        >Phân loại:
        <select id="filterCategory">
          <option value="">Tất cả</option>
        </select>
      </label>
    </div>

    <table id="productTable">
      <thead>
        <tr>
          <th>Tên</th>
          <th>Loại</th>
          <th>Giá</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      let products = [];

      function renderTable(list) {
        const tbody = document.querySelector("#productTable tbody");
        tbody.innerHTML = "";
        list.forEach((p, i) => {
          tbody.innerHTML += `
					<tr>
						<td>${p.name}</td>
						<td>${p.category}</td>
						<td>${p.price}</td>
						<td class="actions">
							<button onclick="editProduct(${i})">Sửa</button>
							<button onclick="deleteProduct(${i})">Xóa</button>
						</td>
					</tr>
				`;
        });
      }

      function updateCategoryFilter() {
        const select = document.getElementById("filterCategory");
        const categories = [...new Set(products.map((p) => p.category))];
        select.innerHTML = '<option value="">Tất cả</option>';
        categories.forEach((c) => {
          select.innerHTML += `<option value="${c}">${c}</option>`;
        });
      }

      document.getElementById("productForm").onsubmit = function (e) {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const category = document.getElementById("category").value.trim();
        const price = parseFloat(document.getElementById("price").value);
        const editIndex = document.getElementById("editIndex").value;
        if (editIndex) {
          products[editIndex] = { name, category, price };
          document.getElementById("editIndex").value = "";
        } else {
          products.push({ name, category, price });
        }
        this.reset();
        renderTable(filterProducts());
        updateCategoryFilter();
      };

      window.editProduct = function (index) {
        const p = products[index];
        document.getElementById("name").value = p.name;
        document.getElementById("category").value = p.category;
        document.getElementById("price").value = p.price;
        document.getElementById("editIndex").value = index;
      };

      window.deleteProduct = function (index) {
        if (confirm("Bạn chắc chắn muốn xóa?")) {
          products.splice(index, 1);
          renderTable(filterProducts());
          updateCategoryFilter();
        }
      };

      function filterProducts() {
        const search = document.getElementById("search").value.toLowerCase();
        const category = document.getElementById("filterCategory").value;
        return products.filter((p) => {
          const matchName = p.name.toLowerCase().includes(search);
          const matchCategory = !category || p.category === category;
          return matchName && matchCategory;
        });
      }

      document.getElementById("search").oninput = function () {
        renderTable(filterProducts());
      };
      document.getElementById("filterCategory").onchange = function () {
        renderTable(filterProducts());
      };

      renderTable(products);
      updateCategoryFilter();
    </script>
  </body>
</html>
